{"version":3,"sources":["/webpack/bootstrap","../src/utils/fs.ts","../src/utils/io.ts","../src/utils/getDomains.ts","../external \"os\"","../external \"child_process\"","../external \"https\"","../src/actions/prepare/main.ts","../src/utils/spawn.ts","../src/actions/prepare/prepareRemoteServer.ts","../node_modules/@actions/core/lib/command.js","../src/utils/request.ts","../node_modules/@actions/core/lib/core.js","../src/utils/getServiceName.ts","../node_modules/github-username-regex/index.js","../external \"path\"","../external \"util\"","../external \"fs\"","../src/utils/isGitHubAction.ts","../src/utils/reportError.ts","/webpack/runtime/node module decorator"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","threw","modules","call","ab","__dirname","startup","runtime","__awaiter","this","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","Object","defineProperty","ensureLinkIs","ensureFilesAre","ensureFileIs","ensureFileContains","exists","mkdir","copyFile","chmod","chown","unlink","fs_1","io_1","args","path","debug","promises","src","dest","dir","options","mode","assign","recursive","filePath","access","filename","contents","current","readFile","catch","toString","includes","length","writeFile","list","all","map","target","readlink","code","undefined","symlink","verbosityLevel","log","input","core_1","isGitHubAction_1","util_1","name","isGitHubAction","Error","getInput","info","formatWithOptions","colors","process","env","DEBUG","console","level","cached","raw","parseInt","isFinite","RangeError","getDomains","domains","split","filter","s","require","main","prepareRemoteServer_1","reportError_1","prepareRemoteServer","parent","reportError","exec","spawn","child_process_1","defaultShell","command","first","defOpts","stdio","opts","unshift","shell","proc","ret","on","exitCode","child","execP","promisify","__importDefault","mod","__esModule","default","spawn_1","getDomains_1","getServiceName_1","request_1","github_username_regex_1","getAuthorizedDeployKey","keyFile","HOME","stdout","trim","getAuthorizedDeployKeyNew","getConfig","authorizedKeys","newKey","push","extra","k","match","request","keys","service","getServiceName","enable","description","startServerCommand","extraConfigs","webRootPath","runtimeServerTimezone","aptDependencies","runtimeAptDependencies","temp","kibanaHost","elastic","hosts","username","password","logstashHosts","journalbeat","verboseSSHArg","verboseSpawnArg","verbosity","prepare","stdin","end","JSON","stringify","__importStar","hasOwnProperty","os","issueCommand","properties","message","cmd","Command","write","EOL","issue","CMD_STRING","[object Object]","cmdStr","key","val","escapeProperty","escapeData","toCommandValue","String","replace","https_1","httpsUrl","response","req","get","res","chunk","command_1","ExitCode","exportVariable","convertedVal","setSecret","secret","addPath","inputPath","delimiter","toUpperCase","required","setOutput","setCommandEcho","enabled","setFailed","Failure","error","isDebug","warning","startGroup","endGroup","group","fn","saveState","getState","serviceName","module$1","GITHUB_ACTIONS","argv","nmd","paths","children","enumerable"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tvar threw = true;\n \t\ttry {\n \t\t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n \t\t\tthrew = false;\n \t\t} finally {\n \t\t\tif(threw) delete installedModules[moduleId];\n \t\t}\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t__webpack_require__.ab = __dirname + \"/\";\n\n \t// the startup function\n \tfunction startup() {\n \t\t// Load entry module and return exports\n \t\treturn __webpack_require__(301);\n \t};\n \t// initialize runtime\n \truntime(__webpack_require__);\n\n \t// run startup\n \treturn startup();\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ensureLinkIs = exports.ensureFilesAre = exports.ensureFileIs = exports.ensureFileContains = exports.exists = exports.mkdir = exports.copyFile = exports.chmod = exports.chown = exports.unlink = void 0;\nconst fs_1 = require(\"fs\");\nconst io_1 = require(\"./io\");\nfunction unlink(...args) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const [path] = args;\n        io_1.debug('unlink:', path);\n        yield fs_1.promises.unlink(...args);\n    });\n}\nexports.unlink = unlink;\nfunction chown(...args) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const [path, value] = args;\n        io_1.debug('chown:', path, 'to', value);\n        yield fs_1.promises.chown(...args);\n    });\n}\nexports.chown = chown;\nfunction chmod(...args) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const [path, value] = args;\n        io_1.debug('chmod:', path, 'to', value);\n        yield fs_1.promises.chmod(...args);\n    });\n}\nexports.chmod = chmod;\nfunction copyFile(...args) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const [src, dest] = args;\n        io_1.debug('copyFile:', src, 'to', dest);\n        yield fs_1.promises.copyFile(...args);\n    });\n}\nexports.copyFile = copyFile;\nfunction mkdir(dir, options) {\n    return __awaiter(this, void 0, void 0, function* () {\n        if (typeof options !== 'object') {\n            options = { mode: options };\n        }\n        options = Object.assign({ recursive: true }, options);\n        io_1.debug('mkdir:', dir);\n        yield fs_1.promises.mkdir(dir, options);\n    });\n}\nexports.mkdir = mkdir;\nfunction exists(filePath) {\n    return __awaiter(this, void 0, void 0, function* () {\n        return fs_1.promises.access(filePath).then(() => true, () => false);\n    });\n}\nexports.exists = exists;\nfunction ensureFileContains(filename, contents) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const current = (yield fs_1.promises.readFile(filename).catch(() => '')).toString();\n        if (current.includes(contents))\n            return false;\n        io_1.debug('Appending to file:', filename, 'bytes:', contents.length);\n        yield fs_1.promises.writeFile(filename, current + contents);\n        return true;\n    });\n}\nexports.ensureFileContains = ensureFileContains;\nfunction ensureFileIs(filename, contents, mode) {\n    return __awaiter(this, void 0, void 0, function* () {\n        // We could just skip the read part of this but this preserves modification times\n        const current = (yield fs_1.promises.readFile(filename).catch(() => '')).toString();\n        if (current === contents)\n            return false;\n        io_1.debug('Writing to file:', filename, 'bytes:', contents.length);\n        yield fs_1.promises.writeFile(filename, contents, { mode });\n        return true;\n    });\n}\nexports.ensureFileIs = ensureFileIs;\nfunction ensureFilesAre(list) {\n    return __awaiter(this, void 0, void 0, function* () {\n        yield Promise.all(list.map(({ filename, contents }) => ensureFileIs(filename, contents)));\n    });\n}\nexports.ensureFilesAre = ensureFilesAre;\nfunction ensureLinkIs(target, path) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const current = yield fs_1.promises.readlink(path).catch(e => {\n            if (e.code === 'ENOENT')\n                return undefined;\n            throw e;\n        });\n        if (target === current)\n            return false;\n        if (current !== undefined)\n            yield unlink(path);\n        io_1.debug('Updating symlink', path, 'to point to', target);\n        yield fs_1.promises.symlink(target, path);\n        return true;\n    });\n}\nexports.ensureLinkIs = ensureLinkIs;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.verbosityLevel = exports.log = exports.debug = exports.input = void 0;\nconst core_1 = require(\"@actions/core\");\nconst isGitHubAction_1 = require(\"./isGitHubAction\");\nconst util_1 = require(\"util\");\n/**\n * Read Github Action `with` field from workflow yml\n * @see https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#jobsjob_idstepswith\n *\n * Often used for public and secret configuration\n *\n * @param name name of the input field\n */\nfunction input(name) {\n    return __awaiter(this, void 0, void 0, function* () {\n        if (!isGitHubAction_1.isGitHubAction) {\n            throw new Error('Not made to work in other environments yet!');\n            // TODO: iff not otherwise read from local config, cli arguments, or prompt the dev?\n        }\n        return core_1.getInput(name);\n    });\n}\nexports.input = input;\nfunction debug(...info) {\n    if (isGitHubAction_1.isGitHubAction) {\n        core_1.debug(util_1.formatWithOptions({ colors: true }, ...info));\n        return;\n    }\n    if (process.env.DEBUG === undefined)\n        return;\n    console.log(...info);\n}\nexports.debug = debug;\nfunction log(level, ...info) {\n    return __awaiter(this, void 0, void 0, function* () {\n        if ((yield verbosityLevel()) < level)\n            return;\n        debug(...info);\n    });\n}\nexports.log = log;\nlet cached;\nfunction verbosityLevel() {\n    return __awaiter(this, void 0, void 0, function* () {\n        if (cached !== undefined)\n            return cached;\n        const raw = yield input('verbosity');\n        const level = parseInt(raw);\n        if (!isFinite(level))\n            throw new Error(`Invalid verbosity: ${raw}.`);\n        if (level < 0)\n            throw new RangeError(`Invalid verbosity: ${level}. 0 is minimum.`);\n        if (level > 3)\n            throw new RangeError(`Invalid verbosity: ${level}. 3 is maximum.`);\n        cached = level;\n        return cached;\n    });\n}\nexports.verbosityLevel = verbosityLevel;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getDomains = void 0;\nconst io_1 = require(\"./io\");\nfunction getDomains() {\n    return __awaiter(this, void 0, void 0, function* () {\n        const raw = yield io_1.input('domains');\n        if (!raw)\n            return;\n        const domains = raw.split(/\\s/).filter(s => s);\n        if (!domains.length) {\n            throw new Error('`domains` not defined.');\n        }\n        return domains;\n    });\n}\nexports.getDomains = getDomains;\n","module.exports = require(\"os\");","module.exports = require(\"child_process\");","module.exports = require(\"https\");","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.main = void 0;\nconst prepareRemoteServer_1 = require(\"./prepareRemoteServer\");\nconst reportError_1 = require(\"../../utils/reportError\");\nfunction main() {\n    return __awaiter(this, void 0, void 0, function* () {\n        yield prepareRemoteServer_1.prepareRemoteServer();\n    });\n}\nexports.main = main;\nif (!module.parent)\n    main().catch(reportError_1.reportError);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.exec = exports.spawn = void 0;\nconst child_process_1 = require(\"child_process\");\nconst util_1 = require(\"util\");\nconst io_1 = require(\"./io\");\nconst defaultShell = '/bin/bash';\nfunction spawn(command, first, ...args) {\n    const defOpts = { stdio: 'inherit' };\n    let opts;\n    if (typeof first === 'string') {\n        args.unshift(first);\n        opts = defOpts;\n    }\n    else {\n        if (first === true) {\n            opts = Object.assign(Object.assign({}, defOpts), { shell: defaultShell });\n        }\n        else {\n            opts = Object.assign(Object.assign({}, defOpts), first);\n        }\n    }\n    io_1.debug('Spawning', command, args);\n    const proc = child_process_1.spawn(command, args, opts);\n    const ret = new Promise((resolve, reject) => {\n        proc.on('exit', exitCode => {\n            if (exitCode) {\n                const e = new Error(`Exit code: ${exitCode}`);\n                e.exitCode = exitCode;\n                reject(e);\n            }\n            else {\n                resolve();\n            }\n        });\n    });\n    ret.child = proc;\n    return ret;\n}\nexports.spawn = spawn;\nconst execP = util_1.promisify(child_process_1.exec);\n/**\n * Run a command and capture output.\n *\n * Prints nothing.\n *\n * - Shell\n * - Captured & Buffered output\n * - Promised result.\n *\n * @param {string} command - The command to run.\n * @param {true|string} shell - Should we use a shell. Default true.\n * @returns {ChildProcess} The child.\n */\nfunction exec(command, shell = true) {\n    io_1.debug('Exec:', command);\n    if (shell === null) {\n        return execP(command);\n    }\n    if (shell === true)\n        shell = defaultShell;\n    return execP(command, { shell });\n}\nexports.exec = exec;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.prepareRemoteServer = void 0;\nconst spawn_1 = require(\"../../utils/spawn\");\nconst io_1 = require(\"../../utils/io\");\nconst getDomains_1 = require(\"../../utils/getDomains\");\nconst getServiceName_1 = require(\"../../utils/getServiceName\");\nconst request_1 = require(\"../../utils/request\");\nconst github_username_regex_1 = __importDefault(require(\"github-username-regex\"));\nconst fs_1 = require(\"../../utils/fs\");\nfunction getAuthorizedDeployKey() {\n    return __awaiter(this, void 0, void 0, function* () {\n        const keyFile = `${process.env.HOME}/.ssh/id_rsa`;\n        return (yield spawn_1.exec(`ssh-keygen -y -f ${keyFile}`)).stdout.trim();\n    });\n}\nfunction getAuthorizedDeployKeyNew() {\n    return __awaiter(this, void 0, void 0, function* () {\n        const keyFile = `${process.env.HOME}/.ssh/id_rsa.2`;\n        if (!(yield fs_1.exists(keyFile)))\n            return;\n        return (yield spawn_1.exec(`ssh-keygen -y -f ${keyFile}`)).stdout.trim();\n    });\n}\nfunction getConfig() {\n    return __awaiter(this, void 0, void 0, function* () {\n        const ret = {};\n        ret.domains = yield getDomains_1.getDomains();\n        ret.authorizedKeys = [yield getAuthorizedDeployKey()];\n        const newKey = yield getAuthorizedDeployKeyNew();\n        if (newKey)\n            ret.authorizedKeys.push(newKey);\n        const extra = (yield io_1.input('extra-keys')).split('\\n').map((k) => __awaiter(this, void 0, void 0, function* () {\n            if (k.match(github_username_regex_1.default))\n                k = `https://github.com/${k}.keys`;\n            if (k.match(/^https:\\/\\//))\n                return (yield request_1.request(k)).split('\\n');\n            return [k];\n        }));\n        for (const keys of yield Promise.all(extra)) {\n            ret.authorizedKeys.push(...keys.filter(s => s));\n        }\n        ret.service = {\n            name: yield getServiceName_1.getServiceName(),\n            enable: (yield io_1.input('disable-service')) !== 'yes',\n            description: yield io_1.input('service-description'),\n            startServerCommand: yield io_1.input('start-server-command'),\n            extraConfigs: yield io_1.input('service-configs'),\n        };\n        ret.webRootPath = yield io_1.input('static-web-root');\n        ret.runtimeServerTimezone = yield io_1.input('runtime-server-timezone');\n        ret.aptDependencies = (yield io_1.input('apt-dependencies'))\n            .split(/\\s/)\n            .filter(s => s);\n        ret.runtimeAptDependencies = (yield io_1.input('runtime-apt-dependencies'))\n            .split(/\\s/)\n            .filter(s => s);\n        const temp = {\n            kibanaHost: yield io_1.input('kibana-host'),\n            elastic: {\n                hosts: (yield io_1.input('elastic-hosts')).split(/\\s/).filter(s => s),\n                username: yield io_1.input('elastic-username'),\n                password: yield io_1.input('elastic-password'),\n            },\n            logstashHosts: (yield io_1.input('logstash-hosts')).split(/\\s/).filter(s => s),\n        };\n        if (temp.kibanaHost ||\n            temp.elastic.hosts.length ||\n            temp.logstashHosts.length) {\n            ret.journalbeat = temp;\n        }\n        // TODO\n        yield io_1.input('verbosity');\n        return ret;\n    });\n}\n/**\n * Connect to a remote server and get it into a state we want by running the prepare script on the remote server.\n *\n * The script is copied to the remote system and then streamed a block of JSON that includes all of the settings from the github action needed to setup the remote system.\n *\n */\nfunction prepareRemoteServer() {\n    return __awaiter(this, void 0, void 0, function* () {\n        const verboseSSHArg = [];\n        const verboseSpawnArg = [];\n        const verbosity = yield io_1.verbosityLevel();\n        if (verbosity > 2)\n            verboseSSHArg.push('-v');\n        if (verbosity > 1)\n            verboseSpawnArg.push('--verbose');\n        // Smoke-test\n        yield spawn_1.spawn('ssh', ...verboseSSHArg, 'runtime-server', 'uptime', '-p');\n        yield spawn_1.spawn('rsync', ...verboseSpawnArg, '--recursive', '--compress', '--links', '--executability', \n        // Build script puts a `remote` folder next to action.yml in dist\n        `${__dirname}/../../prepare/remote/`, \n        // Deploy to home dir\n        'runtime-server:');\n        const prepare = spawn_1.spawn('ssh', { stdio: ['pipe', 'inherit', 'inherit'] }, ...verboseSSHArg, 'runtime-server', 'bash', 'setup.sh', '--gh-actions');\n        if (!prepare.child.stdin)\n            throw new Error('missing stdin???');\n        prepare.child.stdin.end(JSON.stringify(yield getConfig()));\n        yield prepare;\n    });\n}\nexports.prepareRemoteServer = prepareRemoteServer;\n","\"use strict\";\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst os = __importStar(require(\"os\"));\n/**\n * Commands\n *\n * Command Format:\n *   ::name key=value,key=value::message\n *\n * Examples:\n *   ::warning::This is the message\n *   ::set-env name=MY_VAR::some value\n */\nfunction issueCommand(command, properties, message) {\n    const cmd = new Command(command, properties, message);\n    process.stdout.write(cmd.toString() + os.EOL);\n}\nexports.issueCommand = issueCommand;\nfunction issue(name, message = '') {\n    issueCommand(name, {}, message);\n}\nexports.issue = issue;\nconst CMD_STRING = '::';\nclass Command {\n    constructor(command, properties, message) {\n        if (!command) {\n            command = 'missing.command';\n        }\n        this.command = command;\n        this.properties = properties;\n        this.message = message;\n    }\n    toString() {\n        let cmdStr = CMD_STRING + this.command;\n        if (this.properties && Object.keys(this.properties).length > 0) {\n            cmdStr += ' ';\n            let first = true;\n            for (const key in this.properties) {\n                if (this.properties.hasOwnProperty(key)) {\n                    const val = this.properties[key];\n                    if (val) {\n                        if (first) {\n                            first = false;\n                        }\n                        else {\n                            cmdStr += ',';\n                        }\n                        cmdStr += `${key}=${escapeProperty(val)}`;\n                    }\n                }\n            }\n        }\n        cmdStr += `${CMD_STRING}${escapeData(this.message)}`;\n        return cmdStr;\n    }\n}\n/**\n * Sanitizes an input into a string so it can be passed into issueCommand safely\n * @param input input to sanitize into a string\n */\nfunction toCommandValue(input) {\n    if (input === null || input === undefined) {\n        return '';\n    }\n    else if (typeof input === 'string' || input instanceof String) {\n        return input;\n    }\n    return JSON.stringify(input);\n}\nexports.toCommandValue = toCommandValue;\nfunction escapeData(s) {\n    return toCommandValue(s)\n        .replace(/%/g, '%25')\n        .replace(/\\r/g, '%0D')\n        .replace(/\\n/g, '%0A');\n}\nfunction escapeProperty(s) {\n    return toCommandValue(s)\n        .replace(/%/g, '%25')\n        .replace(/\\r/g, '%0D')\n        .replace(/\\n/g, '%0A')\n        .replace(/:/g, '%3A')\n        .replace(/,/g, '%2C');\n}\n//# sourceMappingURL=command.js.map","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.request = void 0;\nconst https_1 = require(\"https\");\nconst io_1 = require(\"./io\");\nfunction request(httpsUrl) {\n    return __awaiter(this, void 0, void 0, function* () {\n        io_1.debug('Request:', httpsUrl);\n        return new Promise((resolve, reject) => __awaiter(this, void 0, void 0, function* () {\n            let response = '';\n            const req = https_1.get(httpsUrl, res => {\n                res.on('data', chunk => {\n                    response += chunk;\n                });\n                res.on('end', () => {\n                    resolve(response);\n                    req.end();\n                });\n            });\n            req.on('error', reject);\n        }));\n    });\n}\nexports.request = request;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst command_1 = require(\"./command\");\nconst os = __importStar(require(\"os\"));\nconst path = __importStar(require(\"path\"));\n/**\n * The code to exit an action\n */\nvar ExitCode;\n(function (ExitCode) {\n    /**\n     * A code indicating that the action was successful\n     */\n    ExitCode[ExitCode[\"Success\"] = 0] = \"Success\";\n    /**\n     * A code indicating that the action was a failure\n     */\n    ExitCode[ExitCode[\"Failure\"] = 1] = \"Failure\";\n})(ExitCode = exports.ExitCode || (exports.ExitCode = {}));\n//-----------------------------------------------------------------------\n// Variables\n//-----------------------------------------------------------------------\n/**\n * Sets env variable for this action and future actions in the job\n * @param name the name of the variable to set\n * @param val the value of the variable. Non-string values will be converted to a string via JSON.stringify\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction exportVariable(name, val) {\n    const convertedVal = command_1.toCommandValue(val);\n    process.env[name] = convertedVal;\n    command_1.issueCommand('set-env', { name }, convertedVal);\n}\nexports.exportVariable = exportVariable;\n/**\n * Registers a secret which will get masked from logs\n * @param secret value of the secret\n */\nfunction setSecret(secret) {\n    command_1.issueCommand('add-mask', {}, secret);\n}\nexports.setSecret = setSecret;\n/**\n * Prepends inputPath to the PATH (for this action and future actions)\n * @param inputPath\n */\nfunction addPath(inputPath) {\n    command_1.issueCommand('add-path', {}, inputPath);\n    process.env['PATH'] = `${inputPath}${path.delimiter}${process.env['PATH']}`;\n}\nexports.addPath = addPath;\n/**\n * Gets the value of an input.  The value is also trimmed.\n *\n * @param     name     name of the input to get\n * @param     options  optional. See InputOptions.\n * @returns   string\n */\nfunction getInput(name, options) {\n    const val = process.env[`INPUT_${name.replace(/ /g, '_').toUpperCase()}`] || '';\n    if (options && options.required && !val) {\n        throw new Error(`Input required and not supplied: ${name}`);\n    }\n    return val.trim();\n}\nexports.getInput = getInput;\n/**\n * Sets the value of an output.\n *\n * @param     name     name of the output to set\n * @param     value    value to store. Non-string values will be converted to a string via JSON.stringify\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction setOutput(name, value) {\n    command_1.issueCommand('set-output', { name }, value);\n}\nexports.setOutput = setOutput;\n/**\n * Enables or disables the echoing of commands into stdout for the rest of the step.\n * Echoing is disabled by default if ACTIONS_STEP_DEBUG is not set.\n *\n */\nfunction setCommandEcho(enabled) {\n    command_1.issue('echo', enabled ? 'on' : 'off');\n}\nexports.setCommandEcho = setCommandEcho;\n//-----------------------------------------------------------------------\n// Results\n//-----------------------------------------------------------------------\n/**\n * Sets the action status to failed.\n * When the action exits it will be with an exit code of 1\n * @param message add error issue message\n */\nfunction setFailed(message) {\n    process.exitCode = ExitCode.Failure;\n    error(message);\n}\nexports.setFailed = setFailed;\n//-----------------------------------------------------------------------\n// Logging Commands\n//-----------------------------------------------------------------------\n/**\n * Gets whether Actions Step Debug is on or not\n */\nfunction isDebug() {\n    return process.env['RUNNER_DEBUG'] === '1';\n}\nexports.isDebug = isDebug;\n/**\n * Writes debug message to user log\n * @param message debug message\n */\nfunction debug(message) {\n    command_1.issueCommand('debug', {}, message);\n}\nexports.debug = debug;\n/**\n * Adds an error issue\n * @param message error issue message. Errors will be converted to string via toString()\n */\nfunction error(message) {\n    command_1.issue('error', message instanceof Error ? message.toString() : message);\n}\nexports.error = error;\n/**\n * Adds an warning issue\n * @param message warning issue message. Errors will be converted to string via toString()\n */\nfunction warning(message) {\n    command_1.issue('warning', message instanceof Error ? message.toString() : message);\n}\nexports.warning = warning;\n/**\n * Writes info to log with console.log.\n * @param message info message\n */\nfunction info(message) {\n    process.stdout.write(message + os.EOL);\n}\nexports.info = info;\n/**\n * Begin an output group.\n *\n * Output until the next `groupEnd` will be foldable in this group\n *\n * @param name The name of the output group\n */\nfunction startGroup(name) {\n    command_1.issue('group', name);\n}\nexports.startGroup = startGroup;\n/**\n * End an output group.\n */\nfunction endGroup() {\n    command_1.issue('endgroup');\n}\nexports.endGroup = endGroup;\n/**\n * Wrap an asynchronous function call in a group.\n *\n * Returns the same type as the function itself.\n *\n * @param name The name of the group\n * @param fn The function to wrap in the group\n */\nfunction group(name, fn) {\n    return __awaiter(this, void 0, void 0, function* () {\n        startGroup(name);\n        let result;\n        try {\n            result = yield fn();\n        }\n        finally {\n            endGroup();\n        }\n        return result;\n    });\n}\nexports.group = group;\n//-----------------------------------------------------------------------\n// Wrapper action state\n//-----------------------------------------------------------------------\n/**\n * Saves state for current action, the state can only be retrieved by this action's post job execution.\n *\n * @param     name     name of the state to store\n * @param     value    value to store. Non-string values will be converted to a string via JSON.stringify\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction saveState(name, value) {\n    command_1.issueCommand('save-state', { name }, value);\n}\nexports.saveState = saveState;\n/**\n * Gets the value of an state set by this action's main execution.\n *\n * @param     name     name of the state to get\n * @returns   string\n */\nfunction getState(name) {\n    return process.env[`STATE_${name}`] || '';\n}\nexports.getState = getState;\n//# sourceMappingURL=core.js.map","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getServiceName = void 0;\nconst io_1 = require(\"./io\");\nconst getDomains_1 = require(\"./getDomains\");\nfunction getServiceName() {\n    return __awaiter(this, void 0, void 0, function* () {\n        const serviceName = yield io_1.input('service-name');\n        if (serviceName)\n            return serviceName;\n        const domains = yield getDomains_1.getDomains();\n        if (!domains || !domains[0])\n            throw new Error('Domains needed if service-name is unset!');\n        return domains[0];\n    });\n}\nexports.getServiceName = getServiceName;\n","var module$1 = /^[a-z\\d](?:[a-z\\d]|-(?=[a-z\\d])){0,38}$/i;\n\nmodule.exports = module$1;\n","module.exports = require(\"path\");","module.exports = require(\"util\");","module.exports = require(\"fs\");","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.isGitHubAction = void 0;\nexports.isGitHubAction = process.env.GITHUB_ACTIONS === 'true' ||\n    process.argv.includes('--gh-actions');\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.reportError = void 0;\nfunction reportError(e) {\n    process.exitCode = 1;\n    // TODO: Add colors for GH Actions\n    console.log('Error in run!');\n    console.log(e);\n}\nexports.reportError = reportError;\n","__webpack_require__.nmd = function(module) {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\tObject.defineProperty(module, 'loaded', {\n\t\tenumerable: true,\n\t\tget: function() { return module.l; }\n\t});\n\tObject.defineProperty(module, 'id', {\n\t\tenumerable: true,\n\t\tget: function() { return module.i; }\n\t});\n\treturn module;\n};"]}